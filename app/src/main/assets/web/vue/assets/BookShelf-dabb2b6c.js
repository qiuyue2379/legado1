import{a1 as Q,n as $,o as _,d as v,g as e,F as b,O as L,t as l,a2 as I,a3 as B,c as q,w as M,f as T,u as a,a4 as G,a5 as D,p as J,i as W,s as X,z as g,N as j,S as ee,k,e as S,A as te,K as se,v as N,a6 as ae,H as oe,B as ne}from"./vendor-0c9d4c13.js";import{d as ce,u as re}from"./loading-ddccb8e8.js";import{_ as H,u as ie,A as z}from"./index-3dbb2f78.js";const O=n=>(J("data-v-fd33c3e8"),n=n(),W(),n),le={class:"books-wrapper"},de={class:"wrapper"},ue=["onClick"],he={class:"cover-img"},pe=["src"],_e={class:"info"},ve={class:"name"},ge={class:"sub"},me={class:"author"},fe={class:"tags"},we={class:"update-info"},Ae=O(()=>e("div",{class:"dot"},"•",-1)),Ie={class:"size"},Be=O(()=>e("div",{class:"dot"},"•",-1)),ke={class:"date"},Se={class:"last-chapter"},ye={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(n,{emit:c}){const y=n;Q(t=>({"036742a7":a(m)}));const x=t=>c("bookClick",G(t)),C=t=>/^data:/.test(t)?t:location.origin+"/cover?path="+encodeURIComponent(t),m=$(()=>y.isSearch?"space-between":"flex-start");return(t,R)=>{const E=D;return _(),v("div",le,[e("div",de,[(_(!0),v(b,null,L(n.books,r=>{var f;return _(),v("div",{class:"book",key:r.bookUrl,onClick:i=>x(r)},[e("div",he,[(_(),v("img",{class:"cover",src:C(r.coverUrl),key:r.coverUrl,alt:"",loading:"lazy"},null,8,pe))]),e("div",_e,[e("div",ve,l(r.name),1),e("div",ge,[e("div",me,l(r.author),1),I(e("div",fe,[(_(!0),v(b,null,L((f=r.kind)==null?void 0:f.split(",").slice(0,2),i=>(_(),q(E,{key:i},{default:M(()=>[T(l(i),1)]),_:2},1024))),128))],512),[[B,n.isSearch]]),I(e("div",we,[Ae,e("div",Ie,"共"+l(r.totalChapterNum)+"章",1),Be,e("div",ke,l(a(ce)(r.lastCheckTime)),1)],512),[[B,!n.isSearch]])]),I(e("div",{class:"intro"},l(r.intro),513),[[B,n.isSearch]]),I(e("div",{class:"dur-chapter"}," 已读："+l(r.durChapterTitle),513),[[B,!n.isSearch]]),e("div",Se,"最新："+l(r.latestChapterTitle),1)])],8,ue)}),128))])])}}},xe=H(ye,[["__scopeId","data-v-fd33c3e8"]]);const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==";const V=n=>(J("data-v-1fc5c811"),n=n(),W(),n),Re={class:"index-wrapper"},Ee={class:"navigation-wrapper"},ze=V(()=>e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),Me={class:"search-wrapper"},Te={class:"bottom-wrapper"},Ve={class:"recent-wrapper"},Pe=V(()=>e("div",{class:"recent-title"},"最近阅读",-1)),be={class:"reading-recent"},Le={class:"setting-wrapper"},Ne=V(()=>e("div",{class:"setting-title"},"基本设定",-1)),De={class:"setting-item"},Je={class:"bottom-icons"},We={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},He={class:"bottom-icon"},Oe=["src"],Ze={__name:"BookShelf",setup(n){const c=ie(),{connectStatus:y,connectType:x,newConnect:C,shelf:m}=X(c),t=g({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),R=g(null),{showLoading:E,closeLoading:r,loadingWrapper:f}=re(R,"正在获取书籍信息"),i=g([]),d=g(""),w=g(!1);j(()=>{if(!(w.value&&d.value!="")){if(w.value=!1,i.value=[],d.value==""){i.value=m.value;return}i.value=m.value.filter(s=>s.name.includes(d.value)||s.author.includes(d.value))}});const Z=()=>{d.value!=""&&(i.value=[],c.clearSearchBooks(),E(),w.value=!0,z.search(d.value,s=>{try{c.setSearchBooks(JSON.parse(s)),c.searchBooks.forEach(o=>i.value.push(o))}catch(o){throw k.error("后端数据错误"),o}},()=>{r(),i.value.length==0&&k.info("搜索结果为空")}))},K=()=>{},F=ae(),Y=async s=>{const{bookUrl:o,name:h,author:u,durChapterIndex:p=0,durChapterPos:A=0}=s;await z.saveBook(s),P(o,h,u,p,A)},P=(s,o,h,u,p)=>{o!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",s),sessionStorage.setItem("bookName",o),sessionStorage.setItem("bookAuthor",h),sessionStorage.setItem("chapterIndex",u),sessionStorage.setItem("chapterPos",p),t.value={name:o,author:h,url:s,chapterIndex:u,chapterPos:p},localStorage.setItem("readingRecent",JSON.stringify(t.value)),F.push({path:"/chapter"}))};ee(()=>{let s=localStorage.getItem("readingRecent");s!=null&&(t.value=JSON.parse(s),typeof t.value.chapterIndex>"u"&&(t.value.chapterIndex=0)),f(c.saveBookProgress().finally(U))});const U=()=>z.getBookShelf().then(s=>{c.setConnectType("success"),s.data.isSuccess?c.addBooks(s.data.data.sort(function(o,h){var u=o.durChapterTime||0,p=h.durChapterTime||0;return p-u})):k.error(s.data.errorMsg),c.setConnectStatus("已连接 "),c.setNewConnect(!1)}).catch(function(s){throw c.setConnectType("danger"),c.setConnectStatus("连接失败"),k.error("后端连接失败"),c.setNewConnect(!1),s});return(s,o)=>{const h=oe,u=D,p=xe;return _(),v("div",Re,[e("div",Ee,[ze,e("div",Me,[S(h,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:a(d),"onUpdate:modelValue":o[0]||(o[0]=A=>te(d)?d.value=A:null),class:"search-input","prefix-icon":a(ne),onKeyup:se(Z,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"])]),e("div",Te,[e("div",Ve,[Pe,e("div",be,[S(u,{type:a(t).name=="尚无阅读记录"?"warning":"",class:N(["recent-book",{"no-point":a(t).url==""}]),size:"large",onClick:o[1]||(o[1]=A=>P(a(t).url,a(t).name,a(t).author,a(t).chapterIndex,a(t).chapterPos))},{default:M(()=>[T(l(a(t).name),1)]),_:1},8,["type","class"])])]),e("div",Le,[Ne,e("div",De,[S(u,{type:a(x),size:"large",class:N(["setting-connect",{"no-point":a(C)}]),onClick:K},{default:M(()=>[T(l(a(y)),1)]),_:1},8,["type","class"])])])]),e("div",Je,[e("a",We,[e("div",He,[e("img",{src:a(Ce),alt:""},null,8,Oe)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:R},[S(p,{books:a(i),onBookClick:Y,isSearch:a(w)},null,8,["books","isSearch"])],512)])}}},Ue=H(Ze,[["__scopeId","data-v-1fc5c811"]]);export{Ue as default};
