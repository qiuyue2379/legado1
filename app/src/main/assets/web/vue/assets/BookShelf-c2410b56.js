import{a1 as Q,x as $,o as g,d as m,g as e,F as V,M as P,t as d,a2 as B,a3 as S,c as q,w as z,f as M,u as o,a4 as G,a5 as L,p as N,i as W,s as X,v as _,P as j,I as D,R as ee,k,e as x,y as te,J as se,n as J,a6 as ae,D as oe,z as ne,a7 as ce}from"./vendor-bf77f5c0.js";import{d as re,l as ie}from"./el-loading-b910ac83.js";import{_ as Z,u as le,A as E}from"./index-f4927a88.js";const H=n=>(N("data-v-fd33c3e8"),n=n(),W(),n),de={class:"books-wrapper"},ue={class:"wrapper"},he=["onClick"],pe={class:"cover-img"},ve=["src"],_e={class:"info"},ge={class:"name"},me={class:"sub"},fe={class:"author"},we={class:"tags"},Ie={class:"update-info"},Ae=H(()=>e("div",{class:"dot"},"•",-1)),Be={class:"size"},Se=H(()=>e("div",{class:"dot"},"•",-1)),ke={class:"date"},xe={class:"last-chapter"},ye={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(n,{emit:r}){const y=n;Q(s=>({"036742a7":o(f)}));const C=s=>r("bookClick",G(s)),R=s=>/^data:/.test(s)?s:location.origin+"/cover?path="+encodeURIComponent(s),f=$(()=>y.isSearch?"space-between":"flex-start");return(s,h)=>{const w=L;return g(),m("div",de,[e("div",ue,[(g(!0),m(V,null,P(n.books,c=>{var l;return g(),m("div",{class:"book",key:c.bookUrl,onClick:i=>C(c)},[e("div",pe,[(g(),m("img",{class:"cover",src:R(c.coverUrl),key:c.coverUrl,alt:"",loading:"lazy"},null,8,ve))]),e("div",_e,[e("div",ge,d(c.name),1),e("div",me,[e("div",fe,d(c.author),1),B(e("div",we,[(g(!0),m(V,null,P((l=c.kind)==null?void 0:l.split(",").slice(0,2),i=>(g(),q(w,{key:i},{default:z(()=>[M(d(i),1)]),_:2},1024))),128))],512),[[S,n.isSearch]]),B(e("div",Ie,[Ae,e("div",Be,"共"+d(c.totalChapterNum)+"章",1),Se,e("div",ke,d(o(re)(c.lastCheckTime)),1)],512),[[S,!n.isSearch]])]),B(e("div",{class:"intro"},d(c.intro),513),[[S,n.isSearch]]),B(e("div",{class:"dur-chapter"}," 已读："+d(c.durChapterTitle),513),[[S,!n.isSearch]]),e("div",xe,"最新："+d(c.latestChapterTitle),1)])],8,he)}),128))])])}}},Ce=Z(ye,[["__scopeId","data-v-fd33c3e8"]]);const Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==";const T=n=>(N("data-v-7e6be94e"),n=n(),W(),n),Ee={class:"index-wrapper"},ze={class:"navigation-wrapper"},Me=T(()=>e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),Te={class:"search-wrapper"},be={class:"bottom-wrapper"},Ve={class:"recent-wrapper"},Pe=T(()=>e("div",{class:"recent-title"},"最近阅读",-1)),De={class:"reading-recent"},Je={class:"setting-wrapper"},Le=T(()=>e("div",{class:"setting-title"},"基本设定",-1)),Ne={class:"setting-item"},We={class:"bottom-icons"},Ze={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},He={class:"bottom-icon"},Oe=["src"],Fe={__name:"BookShelf",setup(n){const r=le(),{connectStatus:y,connectType:C,newConnect:R,shelf:f}=X(r),s=_({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),h=_(!1),w=_(null),c=_(null);j(h,t=>{var a;if(!t)return(a=c.value)==null?void 0:a.close();c.value=ce.service({target:w.value,spinner:ie,text:"正在获取书籍信息",lock:!0})});const l=_([]);D(()=>{l.value.length>0&&(h.value=!1)});const i=_(""),I=_(!1);D(()=>{if(!(I.value&&i.value!="")){if(I.value=!1,l.value=[],i.value==""){l.value=f.value;return}l.value=f.value.filter(t=>t.name.includes(i.value)||t.author.includes(i.value))}});const O=()=>{i.value!=""&&(l.value=[],r.clearSearchBooks(),h.value=!0,I.value=!0,E.search(i.value,t=>{try{r.setSearchBooks(JSON.parse(t)),r.searchBooks.forEach(a=>l.value.push(a))}catch(a){throw k.error("后端数据错误"),a}},()=>{h.value=!1,l.value.length==0&&k.info("搜索结果为空")}))},F=()=>{},K=ae(),Y=async t=>{const{bookUrl:a,name:p,author:u,durChapterIndex:v=0,durChapterPos:A=0}=t;await E.saveBook(t),b(a,p,u,v,A)},b=(t,a,p,u,v)=>{a!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",t),sessionStorage.setItem("bookName",a),sessionStorage.setItem("bookAuthor",p),sessionStorage.setItem("chapterIndex",u),sessionStorage.setItem("chapterPos",v),s.value={name:a,author:p,url:t,chapterIndex:u,chapterPos:v},localStorage.setItem("readingRecent",JSON.stringify(s.value)),K.push({path:"/chapter"}))};ee(async()=>{let t=localStorage.getItem("readingRecent");t!=null&&(s.value=JSON.parse(t),typeof s.value.chapterIndex>"u"&&(s.value.chapterIndex=0)),h.value=!0,U()});const U=()=>{E.getBookShelf().then(t=>{r.setConnectType("success"),t.data.isSuccess?r.addBooks(t.data.data.sort(function(a,p){var u=a.durChapterTime||0,v=p.durChapterTime||0;return v-u})):(k.error(t.data.errorMsg),h.value=!1),r.setConnectStatus("已连接 "),r.setNewConnect(!1)}).catch(function(t){throw h.value=!1,r.setConnectType("danger"),r.setConnectStatus("连接失败"),k.error("后端连接失败"),r.setNewConnect(!1),t})};return(t,a)=>{const p=oe,u=L,v=Ce;return g(),m("div",Ee,[e("div",ze,[Me,e("div",Te,[x(p,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:o(i),"onUpdate:modelValue":a[0]||(a[0]=A=>te(i)?i.value=A:null),class:"search-input","prefix-icon":o(ne),onKeyup:se(O,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"])]),e("div",be,[e("div",Ve,[Pe,e("div",De,[x(u,{type:o(s).name=="尚无阅读记录"?"warning":"",class:J(["recent-book",{"no-point":o(s).url==""}]),size:"large",onClick:a[1]||(a[1]=A=>b(o(s).url,o(s).name,o(s).author,o(s).chapterIndex,o(s).chapterPos))},{default:z(()=>[M(d(o(s).name),1)]),_:1},8,["type","class"])])]),e("div",Je,[Le,e("div",Ne,[x(u,{type:o(C),size:"large",class:J(["setting-connect",{"no-point":o(R)}]),onClick:F},{default:z(()=>[M(d(o(y)),1)]),_:1},8,["type","class"])])])]),e("div",We,[e("a",Ze,[e("div",He,[e("img",{src:o(Re),alt:""},null,8,Oe)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:w},[x(v,{books:o(l),onBookClick:Y,isSearch:o(I)},null,8,["books","isSearch"])],512)])}}},Qe=Z(Fe,[["__scopeId","data-v-7e6be94e"]]);export{Qe as default};
